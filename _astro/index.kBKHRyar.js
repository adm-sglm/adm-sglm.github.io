import{ax as d,a8 as p}from"./chunk-T45N425O.B8K6SYxX.js";function f(s,t){s.indexOf(t)===-1&&s.push(t)}function l(s,t){const e=s.indexOf(t);e>-1&&s.splice(e,1)}const m=s=>s;class v{constructor(){this.subscriptions=[]}add(t){return f(this.subscriptions,t),()=>l(this.subscriptions,t)}notify(t,e,i){const n=this.subscriptions.length;if(n)if(n===1)this.subscriptions[0](t,e,i);else for(let r=0;r<n;r++){const a=this.subscriptions[r];a&&a(t,e,i)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}function y(s,t){return t?s*(1e3/t):0}const{schedule:A,cancel:w,state:c}=d(typeof requestAnimationFrame<"u"?requestAnimationFrame:m,!0);let o;function g(){o=void 0}const h={now:()=>(o===void 0&&h.set(c.isProcessing||p.useManualTiming?c.timestamp:performance.now()),o),set:s=>{o=s,queueMicrotask(g)}},u=30,V=s=>!isNaN(parseFloat(s));class F{constructor(t,e={}){this.version="__VERSION__",this.canTrackVelocity=null,this.events={},this.updateAndNotify=(i,n=!0)=>{const r=h.now();if(this.updatedAt!==r&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(i),this.current!==this.prev&&(this.events.change?.notify(this.current),this.dependents))for(const a of this.dependents)a.dirty();n&&this.events.renderRequest?.notify(this.current)},this.hasAnimated=!1,this.setCurrent(t),this.owner=e.owner}setCurrent(t){this.current=t,this.updatedAt=h.now(),this.canTrackVelocity===null&&t!==void 0&&(this.canTrackVelocity=V(this.current))}setPrevFrameValue(t=this.current){this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt}onChange(t){return this.on("change",t)}on(t,e){this.events[t]||(this.events[t]=new v);const i=this.events[t].add(e);return t==="change"?()=>{i(),A.read(()=>{this.events.change.getSize()||this.stop()})}:i}clearListeners(){for(const t in this.events)this.events[t].clear()}attach(t,e){this.passiveEffect=t,this.stopPassiveEffect=e}set(t,e=!0){!e||!this.passiveEffect?this.updateAndNotify(t,e):this.passiveEffect(t,this.updateAndNotify)}setWithVelocity(t,e,i){this.set(e),this.prev=void 0,this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt-i}jump(t,e=!0){this.updateAndNotify(t),this.prev=t,this.prevUpdatedAt=this.prevFrameValue=void 0,e&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){this.events.change?.notify(this.current)}addDependent(t){this.dependents||(this.dependents=new Set),this.dependents.add(t)}removeDependent(t){this.dependents&&this.dependents.delete(t)}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const t=h.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||t-this.updatedAt>u)return 0;const e=Math.min(this.updatedAt-this.prevUpdatedAt,u);return y(parseFloat(this.current)-parseFloat(this.prevFrameValue),e)}start(t){return this.stop(),new Promise(e=>{this.hasAnimated=!0,this.animation=t(e),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.dependents?.clear(),this.events.destroy?.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function E(s,t){return new F(s,t)}export{F as M,v as S,f as a,c as b,w as c,A as f,E as m,m as n,h as t,y as v};
